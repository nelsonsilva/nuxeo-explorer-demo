<html>
<head><meta charset="utf-8" /><title>Complete XP Graph</title></head>
<body>
<div>
  <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
  <script src="https://cdn.plot.ly/plotly-latest.js"></script>    
  <div id="myDiv" class="plotly-graph-div" style="height:2000px; width:2000px;"></div>
  <script type="text/javascript">
    Plotly.d3.json('data/complete_xp_graph_ref.json', function(err, fig) {

      if (err) {
         alert("Error retrieving json data");
         return;
      }

      nodes_by_key = {}
      node_labels = []
      node_colors = []
      node_weights = []
      node_shapes = []
      Xn = []
      Yn = []
      Zn = []
      for (var i = 0; i < fig.nodes.length; i++) {
        node = fig.nodes[i];
        nodes_by_key[node.id] = node
        label = `<b>${node.label}</b><br />Type: ${node.type}<br />Category: ${node.category}<br />Weight: ${node.weight}<br />x: ${node.x}<br />y: ${node.y}<br /> z:${node.z}`;
        node_labels.push(label);
        node_colors.push(node.color);
        node_weights.push(node.weight*5);
        if (node.type == 'BUNDLE') {
          node_shapes.push('diamond')
        } else if (node.type == 'COMPONENT') {
          node_shapes.push('square')
        } else if (node.type == 'SERVICE') {
          node_shapes.push('diamond-open')
        } else if (node.type == 'EXTENSION_POINT') {
          node_shapes.push('cross')
        } else {
          node_shapes.push('circle')
        }
        Xn.push(node['x']);
        Yn.push(node['y']);
        Zn.push(node['z']);
      }

      Xe = []
      Ye = []
      Ze = []
      edge_labels = []
      edge_colors = []
      for (var i = 0; i < fig.edges.length; i++) {
        edge = fig.edges[i];
        edge_labels.push(`${edge.source} <b>${edge.value}</b> ${edge.target}`);
        if (edge.value == 'CONTAINS') {
          edge_colors.push('#00CC00')
        } else if (edge.value == 'REFERENCES') {
          edge_colors.push('#00CC00')
        } else if (edge.value == 'REQUIRES') {
          edge_colors.push('#FFA000')
        } else if (edge.value == 'SOFT_REQUIRES') {
          edge_colors.push('#FDD835')
        } else {
          edge_colors.push('#03C04A')
        }
        s = nodes_by_key[edge.source];
        t = nodes_by_key[edge.target];
        Xe.push(s['x'], t['x'], null);
        Ye.push(s['y'], t['y'], null);
        Ze.push(s['z'], t['z'], null);
      }

      var trace_edges = {
        x: Xe,
        y: Ye,
        z: Ze,
        mode: 'lines',
        name: 'Edges',
        hoverinfo: 'none',
        text: edge_labels,
        line: {
          color: 'grey',
          width: 2,
          opacity: 0.5
        },
        type: 'scatter3d'
      };

      var trace_nodes = {
        x: Xn,
        y: Yn,
        z: Zn,
        mode: 'markers',
        name: 'Nodes',
        hoverinfo: 'text',
        text: node_labels,
        marker: {
          color: node_colors,
          // size: node_weights,
          size: 6,
          symbol: node_shapes,
          opacity: 0.8,
          line: {
            color: "rgb(50,50,50)",
            width: 0.5
          },
        },
        type: 'scatter3d'
      };

      var data = [trace_nodes, trace_edges];

      var layout = {
        margin: {t: 100},
        title: {text: 'Nuxeo Complete XP Graph'},
        showlegend: true,
        hovermode: 'closest',
        width: 2000,
        height: 2000,
        scene: {
          xaxis: {
            backgroundcolor: "#F0F0F0",
            gridcolor: "white",
            showbackground: true,
            zerolinecolor: "white",
          },
          yaxis: {
            backgroundcolor: "#F0F8FF",
            gridcolor: "white",
            showbackground: true,
            zerolinecolor: "white",
          },
          zaxis: {
            backgroundcolor: "#E5ECF6",
            gridcolor: "white",
            showbackground: true,
            zerolinecolor: "white",
          }}
      };

      Plotly.newPlot('myDiv', data, layout);
	});
  </script>
</div>
</body>
</html>