<html>
<head><meta charset="utf-8" /></head>
<body>
<div>
  <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
  <script src="https://cdn.plot.ly/plotly-latest.js"></script>    
  <div id="myDiv" class="plotly-graph-div" style="height:2000px; width:2000px;"></div>
  <script type="text/javascript">
    Plotly.d3.json('data/complete_graph_ref.json', function(err, fig) {

      if (err) {
         alert("Error retrieving json data");
         return;
      }

      nodes_by_key = {}
      labels = []
      node_colors = []
      node_weights = []
      node_shapes = []
      Xn = []
      Yn = []
      Zn = []
      for (var i = 0; i < fig.nodes.length; i++) {
        node = fig.nodes[i];
        nodes_by_key[node.id] = node
        label = `<b>${node.label}</b><br />Type: ${node.type}<br />Category: ${node.category}<br />Weight: ${node.weight}<br />x: ${node.x}<br />y: ${node.y}<br /> z:${node.z}`;
        labels.push(label);
        if (node.color) {
          node_colors.push(node.color);
        } else {
          node_colors.push("#000000");
        }
        node_weights.push(node.weight*5);
        if (node.type == 'BUNDLE') {
          node_shapes.push('diamond')
        } else if (node.type == 'COMPONENT') {
          node_shapes.push('square')
        } else if (node.type == 'SERVICE') {
          node_shapes.push('diamond')
        } else if (node.type == 'EXTENSION_POINT') {
          node_shapes.push('cross')
        } else {
          node_shapes.push('circle')
        }
        Xn.push(node['x']);
        Yn.push(node['y']);
        Zn.push(node['z']);
      }

      Xe = []
      Ye = []
      Ze = []
      edge_labels = []
      for (var i = 0; i < fig.edges.length; i++) {
        edge = fig.edges[i];
        edge_labels.push(`<b>${edge.value}</b>`);
        s = nodes_by_key[edge.source];
        t = nodes_by_key[edge.target];
        Xe.push(s['x'], t['x'], null);
        Ye.push(s['y'], t['y'], null);
        Ze.push(s['z'], t['z'], null);
      }

     var trace_edges = {
        x: Xe,
        y: Ye,
        z: Ze,
        mode: 'lines',
        name: 'Edges',
        hoverinfo: 'text',
        text: edge_labels,
        marker: {
          size: 12,
          line: {
            color: 'rgba(217, 217, 217, 0.14)',
            width: 1
          },
          opacity: 0.8
        },
        type: 'scatter3d'
      };
      
      var trace_nodes = {
        x: Xn,
        y: Yn,
        z: Zn,
        mode: 'markers',
        name: 'Nodes',
        hoverinfo: 'text',
        text: labels,
        marker: {
          color: node_colors,
          colorscale: 'Viridis',
          // size: node_weights,
          size: 6,
          symbol: node_shapes,
          line: {
            color: 'rgb(204, 204, 204)',
            width: 1
          },
          opacity: 0.8
        },
        type: 'scatter3d'
      };

      var data = [trace_nodes, trace_edges];

      var layout = {
        margin: {t: 100},
        title: {text: 'Nuxeo Bundles'},
        showlegend: true,
        hovermode: 'closest',
        width: 2000,
        height: 2000,
      };

      Plotly.newPlot('myDiv', data, layout);
	});
  </script>
</div>
</body>
</html>